#!/bin/sh -ex

cd "$(dirname $0)"

# To be called from /etc/service/ewindow/run Stuff to execute on boot by root user

modprobe bcm2835_v4l2

# Prepare TAP device to run peervpn as user
#HOSTNAME=ewindow-$(cat /home/ewindow/config/id)
#hostname $HOSTNAME
#echo $HOSTNAME > /etc/hostname

V6ADDR=fde1:c0fe::`sed 's/.//3;s/.//8;s/.//13;' /sys/class/net/eth0/address`/64
ip link set dev eth0 up
ip link set dev wlan0 up
ip tuntap add dev ewindow0 mode tap
ip link set dev ewindow0 up
ip -6 addr add ${V6ADDR} dev ewindow0


# Disable screen blanking
sudo sh -c "TERM=linux setterm -blank 0 >/dev/tty0"

su ewindow -c "svscan ./service"

